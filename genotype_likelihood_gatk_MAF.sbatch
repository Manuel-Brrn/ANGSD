#!/bin/bash
#SBATCH --job-name=urartu_maf_ref
#SBATCH --output=/home/barrientosm/scratch/angsd/logs_jobs/log_%j_%x_out.txt
#SBATCH --error=/home/barrientosm/scratch/angsd/logs_jobs/log_%j_%x_err.txt
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --mem=9G
#SBATCH --time=20:00:00
#SBATCH --partition=agap_normal

output_dir="/home/barrientosm/scratch/angsd_analysis/urartu/gatk_GL/maf"
# Input: List of BAM files containing the samples
#bam_list_speltoides="/home/barrientosm/scratch/GeCKO/CONFIG/WORKFLOWS_OUTPUTS/READ_MAPPING/speltoides_transcriptome_YANG_2023/bams_list.txt"
bam_list_urartu="/home/barrientosm/scratch/GeCKO/CONFIG/WORKFLOWS_OUTPUTS/READ_MAPPING/urartu_TrMo_mapping/bams_list_corrected.txt"

./angsd -bam $bam_list_urartu \
  -GL 2 \
  -minMapQ 30 \
  -minQ 20 \
  -only_proper_pairs 1 \
  -remove_bads 1 \
  -ref /home/barrientosm/scratch/GeCKO/Refs/urartu/urartu_transcriptome.fasta \
  -doGlf 2 \
  -out $output_dir/urartu \
  -doMajorMinor 1 \
  -doMaf 1 \
  -minMaf 0.05 \
  -SNP_pval 1e-6 \
  -minInd 7 \
  -setMinDepthInd 10 \
  -P 5

 # -doMajorMinor 1 \
 # use a maximum likelihood approach to choose the major and minor alleles

# -doMaf 1: Known major, and Known minor
# Here both the major and minor allele is assumed to be known (inferred or given by user)
# The allele frequency is the obtained using based on the genotype likelihoods

# -minMaf 0.05	Filters sites with minor allele frequency lower than 0.05.
# -SNP_pval 1e-6	Sets a p-value threshold for calling SNPs (based on likelihood ratio test).

# The file urartu.mafs.gz is an output file generated by ANGSD when using the option -doMaf 1. 
# It contains information about Minor Allele Frequencies (MAFs) across the analyzed sites.

# Explanation of urartu.mafs.gz:

#    MAF represents the frequency of the less common allele at each site.
 #   The file is compressed in gzip format (.gz) to save space.
#    It contains several columns, usually with the following structure:

# Column	Description
# Chromosome	Name of the reference sequence (e.g., contig or scaffold name).
# Position	Position of the site in the reference sequence.
# Major	Inferred major allele (most common allele at that site).
# Minor	Inferred minor allele (less common allele at that site).
# Frequency	Estimated minor allele frequency (between 0 and 1).
# Unknowns	Number of individuals without information at that site.
# p-value	Statistical significance of the site (based on the Likelihood Ratio Test (LRT) if -SNP_pval is used).

# How to Interpret It:

#    The major and minor alleles are inferred from the genotype likelihoods.
 #   Sites with high MAF indicate polymorphic regions.
 #   Sites with low MAF suggest rare variants or sequencing errors.
#    The p-value helps filter out uncertain SNPs (based on the -SNP_pval threshold).
